{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="vieproductos" name="productos" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{% static 'img/717logo.png' %}" type="image/x-icon">
    <title>Productos - 717 Tienda Online</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/productos.css'%}">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="{% static 'img/717logo.png'%}" alt="Logo" width="70" height="70">
        </div>
        <nav>
            <ul>
                <li><a href='{% url "inicio" %}'>INICIO</a></li>
                <li><a href='{% url "productos" %}'>PRODUCTOS</a></li>
                <li><a href='{% url "contacto" %}'>CONTACTO</a></li>
                <li><a href='{% url "login" %}'>INICIO DE SESIÓN</a></li>
                <li><a href='{% url "cart" %}'><i data-lucide="shopping-cart"></i></a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <section id="productos" class="productos">
            <h2>Nuestros Productos</h2>
            <div class="product-grid" id="product-grid">
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-grid container">
            <div>
                <h3>SÍGUENOS</h3>
                <div class="social-icons">
                    <a href="#"><i data-lucide="instagram"></i></a>
                    <a href="#"><i data-lucide="facebook"></i></a>
                    <a href="#"><i data-lucide="twitter"></i></a>
                </div>
            </div>
            <div>
                <h3>CATEGORÍAS</h3>
                <ul>
                    <li><a href='{% url "inicio" %}'>INICIO</a></li>
                    <li><a href='{% url "productos" %}'>PRODUCTO</a></li>
                    <li><a href='{% url "contacto" %}'>CONTACTO</a></li>
                </ul>
            </div>
            <div>
                <h3>NAVEGACIÓN</h3>
                <ul>
                    <li><a href='{% url "inicio" %}'>INICIO</a></li>
                    <li><a href='{% url "productos" %}'>PRODUCTO</a></li>
                    <li><a href='{% url "contacto" %}'>CONTACTO</a></li>
                    <li><a href='{% url "legal" %}'>LEGAL</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-logo">
            <img src="{% static 'img/717logo.png'%}" alt="717 Logo" width="60" height="60">
        </div>
    </footer>

    <script>
        lucide.createIcons();
        
        const products = [
            { id: 1, name: 'ESQUINA THE BEGINNING', description: 'Descripción breve del producto.', price: 70000, image: '../static/img/esquina.jpg' },
            { id: 2, name: 'BIG HIT THE BEGINNING', description: 'Descripción breve del producto.', price: 70000, image: '../static/img/BIGHIT.jpg' },
            { id: 3, name: 'BLOOD OF CHRIST', description: 'Descripción breve del producto.', price: 55000, oldPrice: 70000, image: '../static/img/blood.jpg' },
            { id: 4, name: 'GANGSTA LOVE', description: 'Descripción breve del producto.', price: 55000, oldPrice: 70000, image: '../static/img/gangsta_love.jpg' },
            { id: 5, name: 'OLD PAIN FIRE', description: 'Descripción breve del producto.', price: 55000, oldPrice: 70000, image: '../static/img/OLDPAIN.jpg' },
        ];

        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function renderProducts() {
            const productGrid = document.getElementById('product-grid');
            productGrid.innerHTML = '';
            
            products.forEach(product => {
                const isInCart = cart.some(item => item.id === product.id);
                const productElement = document.createElement('div');   
                productElement.className = 'product-card';
                productElement.innerHTML = `
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}">
                        <div class="product-overlay">
                            <div class="product-actions">
                                <button onclick="toggleFavorite(${product.id})" class="action-btn favorite-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                </button>
                                <button onclick="viewDetails(${product.id})" class="action-btn view-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                </button>
                            </div>
                            <button onclick="${isInCart ? `removeFromCart(${product.id})` : `addToCart(${product.id})`}" class="cart-btn">
                                ${isInCart ? 'Eliminar del carrito' : 'Añadir al carrito'}
                            </button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <p class="price">$${product.price.toLocaleString()}${product.oldPrice ? ` <span class="old-price">$${product.oldPrice.toLocaleString()}</span>` : ''}</p>
                    </div>
                `;
                productGrid.appendChild(productElement);
            });
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                renderProducts();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderProducts();
        }

        function toggleFavorite(productId) {
            const favorites = JSON.parse(localStorage.getItem('{% url "favoritos" %}')) || [];
            const index = favorites.indexOf(productId);
            
            if (index === -1) {
                favorites.push(productId);
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('{% url "favoritos" %}', JSON.stringify(favorites));
        }

        function viewDetails(productId) {
            window.location.href = `{% url "detalles" %}?id=${productId}`;
        }

        // Initial render
        renderProducts();
    </script>
</body>
</html>